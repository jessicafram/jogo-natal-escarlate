<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>O Natal Escarlate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;700&family=UnifrakturMaguntia&display=swap"
        rel="stylesheet">
    <style>
        body {
            background-image: url('mansao.png');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: #cbd5e0;
            font-family: 'Cormorant Garamond', serif;
        }

        .container {
            background-color: rgba(26, 32, 44, 0.95);
            border: 1px solid #718096;
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
        }

        .game-title {
            color: #e53e3e;
            border-bottom: 1px solid #718096;
            font-family: 'UnifrakturMaguntia', cursive;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .scene-title {
            font-family: 'Cormorant Garamond', serif;
            color: #f6e05e;
        }

        .btn-principal {
            background-color: #c53030;
            transition: background-color 0.3s;
        }

        .btn-principal:hover {
            background-color: #9b2c2c;
        }

        .caderno {
            background-color: #fdfaf3;
            color: #3a2d21;
            border: 1px solid #c7bca1;
            box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.5);
        }

        .caderno-titulo {
            font-family: 'UnifrakturMaguntia', cursive;
            color: #5a4b40;
        }

        .clickable-area {
            position: absolute;
            cursor: pointer;
            transition: background-color 0.2s;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            transform: translate(-50%, -50%);
        }

        .clickable-area:hover {
            background-color: rgba(255, 255, 0, 0.3);
            box-shadow: 0 0 15px yellow;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 50;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: #fdfaf3;
            margin: 10% auto;
            padding: 20px;
            border: 1px solid #c7bca1;
            width: 90%;
            max-width: 500px;
            color: #3a2d21;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        .character-card {
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 2px solid transparent;
        }

        .character-card:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px #f6e05e;
            border-color: #f6e05e;
        }

        .disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>

<body class="p-4 md:p-8 flex items-center justify-center min-h-screen">

    <!-- JANELA DO JOGO -->
    <div id="game-window" class="max-w-5xl w-full mx-auto p-6 rounded-lg container">
        <!-- O conteúdo do jogo será renderizado aqui pelo JavaScript -->
    </div>

    <!-- MODAIS (para Dossiês e Pistas) -->
    <div id="modal-container" class="modal">
        <div class="modal-content">
            <span onclick="fecharModal()"
                class="float-right text-3xl font-bold cursor-pointer hover:text-red-600">&times;</span>
            <div id="modal-body"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <script>
        // --- BASE DE DADOS E ESTADO DO JOGO ---
        const storyData = {
            assassino: "Sophia (A Sócia)",
            suspeitos: {
                "Eleonora (A Viúva)": { retrato: "eleonora.png", motivo: "Ganância e paixão. Tinha um caso com o Dr. Arnaldo e queria a liberdade (e o dinheiro) para fugir com ele.", alibi: "Passei a noite no meu quarto com uma terrível dor de cabeça. O Dr. Arnaldo pode confirmar." },
                "Júnior (O Filho)": { retrato: "junior.png", motivo: "Desespero financeiro. Devia dinheiro a agiotas perigosos e foi deserdado pelo pai.", alibi: "Eu estava no salão de jogos a beber sozinho. Fiquei lá até de madrugada." },
                "Beatriz (A Filha)": { retrato: "beatriz.png", motivo: "Proteger o seu amor. Tinha um romance proibido com o mordomo, Alfredo.", alibi: "Eu estava no meu quarto a ouvir música. Não vi ninguém." },
                "Dr. Arnaldo (O Médico)": { retrato: "arnaldo.png", motivo: "Paixão por Eleonora. Como médico, tem acesso a substâncias letais.", alibi: "Eu estava no meu consultório a organizar os meus ficheiros. Apenas saí brevemente para levar um analgésico a Eleonora." },
                "Sophia (A Sócia)": { retrato: "sophia.png", motivo: "Vingança e ganância. O seu pai foi um antigo sócio que Alistair levou à ruína.", alibi: "Eu estava na biblioteca a ler um livro sobre economia. Não saí de lá a noite toda.", segredo: "Ela cria aves exóticas raras como hobby." },
                "Alfredo (O Mordomo)": { retrato: "alfredo.png", motivo: "Chantagem e proteção. Ama Beatriz e foi chantageado por Alistair para espiar a própria filha.", alibi: "Eu estava na sala de jantar a polir a prataria, como faço todas as noites por volta das 22h." },
                "Celeste (A Governanta)": { retrato: "celeste.png", motivo: "Vingança pessoal. Teve um filho com Alistair no passado, que foi dado para adoção, e descobriu recentemente.", alibi: "Eu estava na cozinha a preparar o pequeno-almoço do dia seguinte." }
            },
            dialogos: {
                "Júnior (O Filho)": [
                    { pergunta: "Onde você estava na noite do crime?", resposta: "Júnior: 'Eu estava no salão de jogos a beber sozinho. Fiquei lá até de madrugada.'" },
                    { pergunta: "Encontrei esta carta de ameaça. É sua?", resposta: "Júnior: 'Está bem, eu confesso... Eu saí pela janela para me encontrar com o agiota. Mas eu não matei o meu pai, eu juro!'", requerPista: "Carta de Ameaça" }
                ],
                "Alfredo (O Mordomo)": [
                    { pergunta: "Qual é o seu álibi?", resposta: "Alfredo: 'Eu estava na sala de jantar a polir a prataria, por volta das 22h.'" },
                    { pergunta: "A foto da festa mostra que já passava das 23h. Onde você realmente estava?", resposta: "Alfredo: 'Fui descoberto... Eu não estava a polir a prata. Eu estava com a menina Beatriz no jardim de inverno.'", requerPista: "Álibi de Alfredo quebrado" }
                ],
                // Adicionar diálogos para os outros personagens aqui
            },
            pistas: {
                "Gravador Digital": { imagem: "gravador_digital.png", descricao: "Um pequeno gravador de áudio. Contém um som agudo e curto." },
                "Carta de Ameaça": { imagem: "carta.png", descricao: "Uma carta de um agiota ameaçando Júnior." },
                "Pena Exótica": { imagem: "pena.png", descricao: "Uma pena iridescente, azul e verde, parcialmente queimada." },
                "Veneno de Serpente": { imagem: "veneno.png", descricao: "Um frasco de veneno encontrado no consultório do Dr. Arnaldo. Uma pista falsa de Sophia." },
                "Álibi de Alfredo quebrado": { descricao: "A foto da festa prova que Alfredo mentiu sobre a hora." },
                "Nome 'Sophia'": { descricao: "O gravador continha a mensagem sonora 'SOPHIA'." }
            }
        };

        let gameState = {};
        const gameWindow = document.getElementById('game-window');
        const modalContainer = document.getElementById('modal-container');
        const modalBody = document.getElementById('modal-body');

        // --- FUNÇÕES DE RENDERIZAÇÃO ---
        function render() {
            gameWindow.innerHTML = '';
            let content = '';
            switch (gameState.currentScreen) {
                case 'inicio':
                    content = `
                        <div id="tela-inicial" class="text-center">
                            <h1 class="text-6xl font-bold mb-4 game-title pb-4">O Natal Escarlate</h1>
                            <div id="narrador-texto" class="text-xl mb-6 h-32 overflow-y-auto border p-4 rounded-md bg-black bg-opacity-20"></div>
                            <div id="escolha-personagem" class="hidden">
                                <p class="text-xl mb-4">Escolha o seu protagonista:</p>
                                <div class="flex flex-col md:flex-row justify-center gap-8">
                                    <div onclick="selecionarPersonagem('arthur')" class="character-card text-center p-4 rounded-lg">
                                        <img src="arthur.png" alt="O Detetive Arthur Hastings" class="w-48 h-48 mx-auto rounded-full object-cover border-4 border-gray-600">
                                        <h3 class="mt-4 text-2xl font-bold">Arthur Hastings</h3>
                                    </div>
                                    <div onclick="selecionarPersonagem('jane')" class="character-card text-center p-4 rounded-lg">
                                        <img src="jane.png" alt="A Detetive Jane Marple" class="w-48 h-48 mx-auto rounded-full object-cover border-4 border-gray-600">
                                        <h3 class="mt-4 text-2xl font-bold">Jane Marple</h3>
                                    </div>
                                </div>
                            </div>
                        </div>`;
                    break;
                case 'jogo':
                    content = `<div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                   <div id="main-panel" class="md:col-span-2">${renderCena()}</div>
                                   <div class="md:col-span-1">${renderCaderno()}</div>
                               </div>`;
                    break;
                case 'final':
                    const vitoria = gameState.vitoria;
                    content = `
                        <div class="text-center">
                            <h2 class="text-5xl font-bold game-title pb-4">${vitoria ? "Caso Encerrado!" : "Fim de Jogo"}</h2>
                            <img src="${vitoria ? 'vitoria_' : 'derrota_'}${gameState.protagonista}.png" class="w-full md:w-1/2 mx-auto my-6 rounded-lg shadow-lg">
                            <p class="text-xl">${vitoria ? "Brilhante! Você juntou as pistas certas e ignorou as distrações. Sophia foi desmascarada." : `Enquanto você acusava a pessoa errada, o verdadeiro assassino preparava a sua armadilha final. Você é a última vítima.`}</p>
                            <button onclick="initGame()" class="mt-6 btn-principal text-white font-bold py-3 px-6 rounded text-lg">Jogar Novamente</button>
                        </div>`;
                    break;
            }
            gameWindow.innerHTML = content;
            if (gameState.currentScreen === 'inicio') typeWriter();
        }

        function renderCena() { /* ... */ }
        function renderCaderno() { /* ... */ }
        function renderInterrogatorio(suspeitoId) { /* ... */ }

        // --- LÓGICA DO JOGO ---
        function typeWriter() { /* ... */ }
        function selecionarPersonagem(nome) { /* ... */ }
        function carregarCena(nomeCena) { /* ... */ }
        function investigar(ponto) { /* ... */ }
        function abrirDossie(id) { /* ... */ }
        function fecharModal() { modalContainer.style.display = 'none'; }
        function interrogar(id) { /* ... */ }
        function fazerPergunta(suspeitoId, indexPergunta) { /* ... */ }
        function adicionarPista(nomePista) { /* ... */ }
        function mostrarPista(nomePista) { /* ... */ }
        function fazerAcusacao() { /* ... */ }

        // --- INICIALIZAÇÃO ---
        function initGame() {
            gameState = {
                currentScreen: 'inicio',
                protagonista: null,
                dia: 1,
                objetivo: "Investigar a cena do crime no escritório.",
                cenaAtual: 'escritorio',
                pistas: new Set(),
                interrogatorios: {}
            };
            Object.keys(storyData.suspeitos).forEach(id => { gameState.interrogatorios[id] = { interrogado: false, perguntasFeitas: new Set() }; });
            render();
        }

        initGame();
    </script>
</body>

</html>